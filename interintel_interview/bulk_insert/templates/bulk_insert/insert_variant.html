{% extends "layout.html" %} {% block content %}
<h1>Insert Product Variant</h1>
<form enctype="multipart/form-data" method="post" class="product-form">
  {% csrf_token %}

  <div class="form-group">
    <label for="sku">SKU</label>
    <!-- {{ form.sku }} -->
    <input type="text" id="sku" name="sku" placeholder="Enter SKU" required />
  </div>

  <div class="form-group">
    <label for="name">Product Variant Name</label>
    <!-- {{ form.name }} -->
    <input
      type="text"
      id="name"
      name="name"
      placeholder="Enter name"
      required
    />
  </div>

  <div class="form-group">
    <label for="price">Product Variant Price</label>
    <!-- {{ form.price }} -->
    <input
      type="number"
      id="price"
      name="price"
      placeholder="Enter price"
      step="0.01"
      required
    />
  </div>

  <div class="form-group">
    <label for="details">Product Variant Details</label>
    <!-- {{ form.details }} -->
    <textarea
      id="details"
      name="details"
      placeholder="Enter details"
    ></textarea>
  </div>

  <div class="form-group">
    <label for="id_product">Select Product</label>
    <select id="id_product" name="product" required>
      <option disabled selected>Select product</option>
      {% for product in products %}
      <option value="{{ product.id }}">{{ product.name }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- <div class="form-group">
    <label for="product">Select Product</label>
    <select id="product" name="product" required>
      <option disabled selected>Select product</option>
      {% for product in products %}
      <option value="{{ product.id }}">{{ product.name }}</option>
      {% endfor %}
    </select>
  </div> -->

  <div class="form-group">
    <button onclick="submitVariantForm()">Insert Variant</button>
    <!-- <input type="submit" value="Submit" /> -->
  </div>
</form>

<br />
<a href="{% url 'home' %}">Home</a>

{% if form.errors %}
<div class="alert alert-danger">
  <strong>Error!</strong> Please correct the following errors:
  <ul>
    {% for field, errors in form.errors.items %} {% for error in errors %}
    <li style="color: red">{{ error }}</li>
    {% endfor %} {% endfor %}
  </ul>
</div>
{% endif %} {% endblock %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  function submitVariantForm() {
    // Gather form data
    var formData = new FormData($("#variantForm")[0]); // Assuming your form ID is 'variantForm'

    // Submit form via AJAX
    $.ajax({
      url: "/insert_variant/", // URL to your Django view
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      success: function (response) {
        if (response.success) {
          alert(
            "Variant inserted successfully with ID: " + response.variant_id
          );
          // Handle success response, if needed
        } else {
          alert("Error: " + response.errors || response.message);
          // Handle error response, if needed
        }
      },
      error: function (xhr, status, error) {
        alert("Error: " + error);
        // Handle AJAX error, if needed
      },
    });
  }
</script>
